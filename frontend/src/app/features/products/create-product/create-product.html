<div class="container">

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1>Product & Stock Management</h1>
            <p>
                Update your listing details and manage assets for
                <span class="highlight">Wireless Audio Max 2</span>
            </p>
        </div>
        <div class="status-pill">
            <span class="dot live"></span>
            Live Preview
        </div>
    </header>

    <div class="main-grid">

        <!-- Left column - Form -->
        <section class="card form-card">
            <div class="card-header">
                <h2>
                    <span class="material-symbols-outlined">edit_note</span>
                    Create Product Details
                </h2>
                <span class="badge">Create Product Form</span>
            </div>

            <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-content">

                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" formControlName="name" placeholder="Enter product name" />
                    <div *ngIf="name?.touched && name?.hasError('required')" class="error">
                        Product name is required
                    </div>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea formControlName="description" rows="6"></textarea>
                    <div *ngIf="description?.touched && description?.hasError('required')" class="error">
                        Description is required
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label>Price (USD)</label>
                        <div class="input-prefix">
                            <span class="prefix">$</span>
                            <input type="number" formControlName="price" step="0.01" min="0" />
                        </div>
                    </div>

                    <div class="form-group half">
                        <label>Quantity</label>
                        <input type="number" formControlName="quantity" min="0" />
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary" [disabled]="form.invalid || form.pristine">
                        <span class="material-symbols-outlined">save</span>
                        Save Changes
                    </button>
                </div>

            </form>
        </section>

        <!-- Right column - Images + Upload -->
        <div class="right-column">

            <div class="image-grid">


                <!-- Main image card -->
                <div class="main-image-card card image-hover" (drop)="onDrop($event, 'main')"
                    (dragover)="onDragOver($event)" (dragenter)="onDragOver($event)">

                    <span class="image-label">Primary Image</span>

                    <img [src]="displayedMain" alt="Main product preview" />

                </div>

                <!-- Thumbnails card -->
                <div class="thumbnails-card card">
                    <div class="thumbnails-header">Media Library</div>
                    <div class="thumbnails-grid" (drop)="onDrop($event, 'thumbnails')" (dragover)="onDragOver($event)"
                        (dragenter)="onDragOver($event)">

                        @for (url of displayedThumbs; track $index) {
                        <div class="thumb-item relative">
                            <img [src]="url" alt="Product thumbnail" />

                            <!-- Only show delete button for newly uploaded previews (not initial ones) -->
                            @if ($index < thumbnailPreviews.length) { <button class="delete-btn"
                                (click)="removeThumbnail($index)">
                                <span class="material-symbols-outlined">close</span>
                                </button>
                                }
                        </div>
                        }

                        <!-- Add new button (also acts as drop zone) -->
                        <label class="thumb-add" for="thumbnails-upload">
                            <span class="material-symbols-outlined">add_a_photo</span>
                            <span>Add New</span>
                        </label>

                        <!-- Hidden input for multiple thumbnails -->
                        <input id="thumbnails-upload" type="file" accept="image/*" multiple
                            (change)="onThumbnailsSelected($event)" hidden />
                    </div>
                </div>
            </div>

            <!-- Drag & drop area -->
            <div class="upload-zone">
                <div class="upload-content">
                    <span class="material-symbols-outlined upload-icon">cloud_upload</span>
                    <h3>Drop files here or click to upload</h3>
                    <p class="small">Max 2MB per image</p>
                    <p class="small warning">Image only validation</p>
                </div>

                <input type="file" class="file-input" accept="image/*" (change)="onMainImageSelected($event)" />
            </div>

        </div>

    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="tech-badges">
            <div class="badge-item">
                <div class="icon-bg green">
                    <span class="material-symbols-outlined">storage</span>
                </div>
                <div>
                    <span class="badge-title">Spring Boot</span>
                    <span class="badge-subtitle">Media Service Online</span>
                </div>
            </div>

            <div class="badge-item">
                <div class="icon-bg blue">
                    <span class="material-symbols-outlined">javascript</span>
                </div>
                <div>
                    <span class="badge-title">Angular v20+ </span>
                    <span class="badge-subtitle">Reactive Engine</span>
                </div>
            </div>
        </div>

        <div class="secure-info">
            <span class="material-symbols-outlined">lock</span>
            Secure Enterprise Connection
        </div>
    </footer>

</div>